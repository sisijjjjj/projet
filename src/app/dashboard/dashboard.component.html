<div class="admin-dashboard">
  <!-- Sidebar Navigation -->
  <div class="sidebar">
    <div class="logo-section">
      <h2>Tableau de bord</h2>
    </div>
    
    <nav class="nav-menu">
      <ul>
        <li [class.active]="activeSection === 'dashboard'" (click)="showSection('dashboard')">
          <i class="fas fa-tachometer-alt"></i> Tableau de bord
        </li>
        <li [class.active]="activeSection === 'students'" (click)="showSection('students')">
          <i class="fas fa-user-graduate"></i> Étudiants
        </li>
        <li [class.active]="activeSection === 'teachers'" (click)="showSection('teachers')">
          <i class="fas fa-chalkboard-teacher"></i> Enseignants
        </li>
        <li [class.active]="activeSection === 'classes'" (click)="showSection('classes')">
          <i class="fas fa-school"></i> Classes
        </li>
        <li [class.active]="activeSection === 'meetings'" (click)="showSection('meetings')">
          <i class="fas fa-users"></i> Réunions
        </li>
        <li [class.active]="activeSection === 'leaves'" (click)="showSection('leaves')">
          <i class="fas fa-calendar-alt"></i> Congés
        </li>
        <li [class.active]="activeSection === 'notes'" (click)="showSection('notes')">
          <i class="fas fa-clipboard-list"></i> Notes
        </li>
      </ul>
    </nav>
    
    <div class="user-section">
      <div class="user-info">
        <div class="avatar">A</div>
        <div class="user-details">
          <span class="name">Administrateur</span>
          <span class="role">Super Admin</span>
        </div>
      </div>
      <button class="logout-btn">
        <i class="fas fa-sign-out-alt"></i> Déconnexion
      </button>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="main-content">
    <div class="header">
      <div class="header-left">
        <h1>{{ getSectionTitle() }}</h1>
        <button class="refresh-btn" (click)="refreshAll()" [disabled]="isRefreshing">
          <i class="fas fa-sync-alt" [class.spin]="isRefreshing"></i> {{ isRefreshing ? 'Actualisation...' : 'Actualiser' }}
        </button>
      </div>
      <div class="header-right">
        <div class="search-box">
          <i class="fas fa-search"></i>
          <input type="text" placeholder="Rechercher...">
        </div>
        <div class="notifications">
          <i class="fas fa-bell"></i>
          <span class="badge">3</span>
        </div>
      </div>
    </div>

    <!-- Dashboard Section -->
    <div *ngIf="activeSection === 'dashboard'" class="dashboard-section">
      <!-- Stats Cards -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon" style="background-color: #4e73df;">
            <i class="fas fa-user-graduate"></i>
          </div>
          <div class="stat-info">
            <h3>{{ stats.activeStudents }}</h3>
            <p>Étudiants actifs</p>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon" style="background-color: #1cc88a;">
            <i class="fas fa-chalkboard-teacher"></i>
          </div>
          <div class="stat-info">
            <h3>{{ stats.teachersCount }}</h3>
            <p>Enseignants</p>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon" style="background-color: #36b9cc;">
            <i class="fas fa-user-slash"></i>
          </div>
          <div class="stat-info">
            <h3>{{ stats.inactiveStudents }}</h3>
            <p>Comptes inactifs</p>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon" style="background-color: #f6c23e;">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <div class="stat-info">
            <h3>{{ stats.lateStudents }}</h3>
            <p>Retards excessifs</p>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon" style="background-color: #e74a3b;">
            <i class="fas fa-calendar-times"></i>
          </div>
          <div class="stat-info">
            <h3>{{ stats.studentsWithExcessiveAbsences }}</h3>
            <p>Absences excessives</p>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon" style="background-color: #858796;">
            <i class="fas fa-users"></i>
          </div>
          <div class="stat-info">
            <h3>{{ stats.totalMeetings }}</h3>
            <p>Réunions</p>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon" style="background-color: #5a5c69;">
            <i class="fas fa-calendar-check"></i>
          </div>
          <div class="stat-info">
            <h3>{{ stats.pendingLeaves }}</h3>
            <p>Congés en attente</p>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon" style="background-color: #f8f9fc;">
            <i class="fas fa-lock"></i>
          </div>
          <div class="stat-info">
            <h3>{{ stats.lockedAccounts }}</h3>
            <p>Comptes verrouillés</p>
          </div>
        </div>
      </div>

      <!-- Charts Row -->
      <div class="charts-row">
        <div class="chart-container white-bg">
          <h4>Activité des étudiants</h4>
          <canvas #activityChart id="activityChart"></canvas>
        </div>
        <div class="chart-container white-bg">
          <h4>Répartition par classe</h4>
          <canvas #classChart id="classChart"></canvas>
        </div>
      </div>
      
      <div class="charts-row">
        <div class="chart-container white-bg">
          <h4>Taux d'absence par mois</h4>
          <canvas #absenceChart id="absenceChart"></canvas>
        </div>
        <div class="chart-container white-bg">
          <h4>Statut des étudiants</h4>
          <canvas #statusChart id="statusChart"></canvas>
        </div>
      </div>
      
      <div class="full-width-chart">
        <div class="chart-container white-bg">
          <h4>Performance des classes</h4>
          <canvas #performanceChart id="performanceChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Students Management Section -->
    <div *ngIf="activeSection === 'students'" class="management-section">
      <div class="section-header">
        <h2>Gestion des étudiants</h2>
        <div class="action-buttons">
          <button class="btn btn-primary" (click)="openModal('add-student')">
            <i class="fas fa-plus"></i> Ajouter
          </button>
          <button class="btn btn-secondary" (click)="lockSelectedStudents()" [disabled]="selectedStudents.length === 0">
            <i class="fas fa-lock"></i> Verrouiller
          </button>
          <button class="btn btn-success" (click)="unlockSelectedStudents()" [disabled]="selectedStudents.length === 0">
            <i class="fas fa-unlock"></i> Déverrouiller
          </button>
          <button class="btn btn-danger" (click)="deleteSelectedStudents()" [disabled]="selectedStudents.length === 0">
            <i class="fas fa-trash"></i> Supprimer
          </button>
        </div>
      </div>
      
      <div class="table-responsive">
        <table class="data-table">
          <thead>
            <tr>
              <th>
                <input type="checkbox" [checked]="selectAllStudents" (change)="toggleSelectAll('students', $event)">
              </th>
              <th>Nom</th>
              <th>Prénom</th>
              <th>Email</th>
              <th>Classe</th>
              <th>Moyenne</th>
              <th>Absences</th>
              <th>Statut</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let student of students" [class.inactive]="student.status === 'INACTIF'">
              <td>
                <input type="checkbox" [checked]="selectedStudents.includes(student.id)" 
                       (change)="toggleSelection('student', student.id, $event)">
              </td>
              <td>{{ student.nom }}</td>
              <td>{{ student.prenom }}</td>
              <td>{{ student.email }}</td>
              <td>{{ getClassName(student) }}</td>
              <td>{{ getStudentAverage(student.id) || '-' }}</td>
              <td>
                <span [class.text-danger]="getStudentUnjustifiedAbsencesCount(student.id) > 3">
                  {{ getStudentAbsencesCount(student.id) }} ({{ getStudentUnjustifiedAbsencesCount(student.id) }} non justifiées)
                </span>
              </td>
              <td>
                <span class="badge" [class.bg-success]="student.status === 'ACTIF'" 
                      [class.bg-danger]="student.status === 'INACTIF'" 
                      [class.bg-secondary]="student.status === 'DIPLOME'">
                  {{ getStatusLabel(student.status) }}
                </span>
              </td>
              <td class="actions">
                <button class="btn btn-sm btn-info" (click)="openModal('edit-student', student)">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-sm btn-warning" (click)="toggleStudentStatus(student.id)">
                  <i class="fas" [class.fa-toggle-on]="student.status === 'ACTIF'" 
                     [class.fa-toggle-off]="student.status !== 'ACTIF'"></i>
                </button>
                <button class="btn btn-sm btn-danger" (click)="deleteStudent(student.id)">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>
            <tr *ngIf="students.length === 0">
              <td colspan="9" class="text-center">Aucun étudiant trouvé</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Teachers Management Section -->
    <div *ngIf="activeSection === 'teachers'" class="management-section">
      <div class="section-header">
        <h2>Gestion des enseignants</h2>
        <div class="action-buttons">
          <button class="btn btn-primary" (click)="openModal('add-teacher')">
            <i class="fas fa-plus"></i> Ajouter
          </button>
          <button class="btn btn-danger" (click)="deleteSelectedTeachers()" [disabled]="selectedTeachers.length === 0">
            <i class="fas fa-trash"></i> Supprimer
          </button>
        </div>
      </div>
      
      <div class="table-responsive">
        <table class="data-table">
          <thead>
            <tr>
              <th>
                <input type="checkbox" [checked]="selectAllTeachers" (change)="toggleSelectAll('teachers', $event)">
              </th>
              <th>Nom</th>
              <th>Prénom</th>
              <th>Email</th>
              <th>Matières</th>
              <th>Classe</th>
              <th>Statut</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let teacher of teachers" [class.inactive]="teacher.status === 'INACTIVE'">
              <td>
                <input type="checkbox" [checked]="selectedTeachers.includes(teacher.id)" 
                       (change)="toggleSelection('teacher', teacher.id, $event)">
              </td>
              <td>{{ teacher.nom }}</td>
              <td>{{ teacher.prenom }}</td>
              <td>{{ teacher.email }}</td>
              <td>
                <span *ngIf="teacher.matieresEnseignees && teacher.matieresEnseignees.length > 0">
                  {{ teacher.matieresEnseignees.join(', ') }}
                </span>
                <span *ngIf="!teacher.matieresEnseignees || teacher.matieresEnseignees.length === 0">-</span>
              </td>
              <td>{{ getTeacherClassNamesDisplay(teacher) }}</td>
              <td>
                <span class="badge" [class.bg-success]="teacher.status === 'ACTIVE'" 
                      [class.bg-danger]="teacher.status === 'INACTIVE'">
                  {{ getStatusLabel(teacher.status) }}
                </span>
              </td>
              <td class="actions">
                <button class="btn btn-sm btn-info" (click)="openModal('edit-teacher', teacher)">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-sm btn-warning" (click)="toggleTeacherStatus(teacher.id)">
                  <i class="fas" [class.fa-toggle-on]="teacher.status === 'ACTIVE'" 
                     [class.fa-toggle-off]="teacher.status !== 'ACTIVE'"></i>
                </button>
                <button class="btn btn-sm btn-danger" (click)="deleteTeacher(teacher.id)">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>
            <tr *ngIf="teachers.length === 0">
              <td colspan="8" class="text-center">Aucun enseignant trouvé</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Classes Management Section -->
    <div *ngIf="activeSection === 'classes'" class="management-section">
      <div class="section-header">
        <h2>Gestion des classes</h2>
        <div class="action-buttons">
          <button class="btn btn-primary" (click)="openModal('add-class')">
            <i class="fas fa-plus"></i> Ajouter
          </button>
        </div>
      </div>
      
      <div class="table-responsive">
        <table class="data-table">
          <thead>
            <tr>
              <th>Nom</th>
              <th>Niveau</th>
              <th>Étudiants</th>
              <th>Enseignants</th>
              <th>Moyenne</th>
              <th>Absences</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let classe of classes">
              <td>{{ classe.nom }}</td>
              <td>{{ classe.niveau }}</td>
              <td>{{ getClassStudentCount(classe.id) }}</td>
              <td>{{ classe.enseignantsNoms || 'Aucun' }}</td>
              <td>{{ classe.moyenneClasse !== undefined ? (classe.moyenneClasse | number:'1.2-2') : 'N/A' }}</td>
              <td>{{ getClassAbsencesCount(classe.id) }}</td>
              <td class="actions">
                <button class="btn btn-sm btn-info" (click)="openModal('edit-class', classe)">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-sm btn-danger" (click)="deleteClass(classe.id)">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>
            <tr *ngIf="classes.length === 0">
              <td colspan="7" class="text-center">Aucune classe trouvée</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Meetings Management Section -->
    <div *ngIf="activeSection === 'meetings'" class="management-section">
      <div class="section-header">
        <h2>Gestion des réunions</h2>
        <div class="action-buttons">
          <button class="btn btn-primary" (click)="openModal('add-meeting')">
            <i class="fas fa-plus"></i> Ajouter
          </button>
          <button class="btn btn-danger" (click)="deleteSelectedMeetings()" [disabled]="selectedMeetings.length === 0">
            <i class="fas fa-trash"></i> Supprimer
          </button>
        </div>
      </div>
      
      <div class="table-responsive">
        <table class="data-table">
          <thead>
            <tr>
              <th>
                <input type="checkbox" [checked]="selectAllMeetings" (change)="toggleSelectAll('meetings', $event)">
              </th>
              <th>Sujet</th>
              <th>Date/Heure</th>
              <th>Lieu</th>
              <th>Enseignant</th>
              <th>Statut</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let meeting of meetings">
              <td>
                <input type="checkbox" [checked]="selectedMeetings.includes(meeting.id)" 
                       (change)="toggleSelection('meeting', meeting.id, $event)">
              </td>
              <td>{{ meeting.sujet }}</td>
              <td>{{ formatDateTime(meeting.dateHeure) }}</td>
              <td>{{ meeting.lieu }}</td>
              <td>{{ meeting.enseignant ? getTeacherName(meeting.enseignant.id) : 'Non assigné' }}</td>
              <td>
                <span class="badge" [class.bg-info]="meeting.statut === 'PLANNED'" 
                      [class.bg-success]="meeting.statut === 'COMPLETED'" 
                      [class.bg-danger]="meeting.statut === 'CANCELLED'">
                  {{ getStatusLabel(meeting.statut) }}
                </span>
              </td>
              <td class="actions">
                <button class="btn btn-sm btn-info" (click)="openModal('edit-meeting', meeting)">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-sm btn-danger" (click)="deleteMeeting(meeting.id)">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>
            <tr *ngIf="meetings.length === 0">
              <td colspan="7" class="text-center">Aucune réunion trouvée</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Leaves Management Section -->
    <div *ngIf="activeSection === 'leaves'" class="management-section">
      <div class="section-header">
        <h2>Gestion des congés</h2>
        <div class="action-buttons">
          <button class="btn btn-primary" (click)="openModal('add-leave')" [disabled]="selectedTeachers.length !== 1">
            <i class="fas fa-plus"></i> Demander un congé
          </button>
        </div>
      </div>
      
      <div class="table-responsive">
        <table class="data-table">
          <thead>
            <tr>
              <th>Demandeur</th>
              <th>Type</th>
              <th>Date début</th>
              <th>Date fin</th>
              <th>Motif</th>
              <th>Statut</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let leave of leaves">
              <td>{{ getRequesterName(leave) }}</td>
              <td>{{ getLeaveTypeLabel(leave.type) }}</td>
              <td>{{ formatDate(leave.dateDebut) }}</td>
              <td>{{ formatDate(leave.dateFin) }}</td>
              <td>{{ leave.motif || '-' }}</td>
              <td>
                <span class="badge" [class.bg-warning]="leave.statut === 'EN_ATTENTE'" 
                      [class.bg-success]="leave.statut === 'APPROUVE'" 
                      [class.bg-danger]="leave.statut === 'REJETE'">
                  {{ getStatusLabel(leave.statut) }}
                </span>
              </td>
              <td class="actions">
                <button *ngIf="leave.statut === 'EN_ATTENTE'" class="btn btn-sm btn-success" 
                        (click)="approveLeave(leave.id)" [disabled]="isProcessing">
                  <i class="fas fa-check"></i> Approuver
                </button>
                <button *ngIf="leave.statut === 'EN_ATTENTE'" class="btn btn-sm btn-danger" 
                        (click)="openRejectDialog(leave.id)" [disabled]="isProcessing">
                  <i class="fas fa-times"></i> Rejeter
                </button>
              </td>
            </tr>
            <tr *ngIf="leaves.length === 0">
              <td colspan="7" class="text-center">Aucun congé trouvé</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Notes Management Section -->
    <div *ngIf="activeSection === 'notes'" class="management-section">
      <div class="section-header">
        <h2>Gestion des notes</h2>
        <div class="action-buttons">
          <button class="btn btn-primary" (click)="openModal('add-note')" [disabled]="selectedStudents.length !== 1">
            <i class="fas fa-plus"></i> Ajouter une note
          </button>
        </div>
      </div>
      
      <div class="table-responsive">
        <table class="data-table">
          <thead>
            <tr>
              <th>Étudiant</th>
              <th>Matière</th>
              <th>Note TP</th>
              <th>Note Examen</th>
              <th>Moyenne</th>
              <th>Date</th>
              <th>Type</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let note of notes">
              <td>{{ note.etudiantId ? getStudentName(note.etudiantId) : 'Non défini' }}</td>
              <td>{{ note.coursId ? getCourseName(note.coursId) : 'Non défini' }}</td>
              <td>{{ note.tp }}</td>
              <td>{{ note.exam }}</td>
              <td>{{ note.moyenne }}</td>
              <td>{{ formatDate(note.date) }}</td>
              <td>{{ getNoteTypeLabel(note.type) }}</td>
              <td class="actions">
                <button class="btn btn-sm btn-danger" (click)="note.id ? deleteNoteById(note.id) : null">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>
            <tr *ngIf="notes.length === 0">
              <td colspan="8" class="text-center">Aucune note trouvée</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Modal -->
    <div class="modal-backdrop" *ngIf="showModal" (click)="closeModal()"></div>
    <div class="modal" *ngIf="showModal" [class.show]="showModal">
      <div class="modal-header">
        <h3>{{ getModalTitle() }}</h3>
        <button class="close-btn" (click)="closeModal()">&times;</button>
      </div>
      
      <div class="modal-body white-bg">
        <!-- Student Form -->
        <form *ngIf="modalContent === 'add-student' || modalContent === 'edit-student'" (submit)="saveForm()" class="compact-form">
          <div class="form-row">
            <div class="form-group half-width">
              <label>Nom</label>
              <input type="text" class="form-control" [(ngModel)]="studentForm.nom" name="nom" required>
            </div>
            
            <div class="form-group half-width">
              <label>Prénom</label>
              <input type="text" class="form-control" [(ngModel)]="studentForm.prenom" name="prenom" required>
            </div>
          </div>
          
          <div class="form-group">
            <label>Email</label>
            <input type="email" class="form-control" [(ngModel)]="studentForm.email" name="email" required>
          </div>
          
          <div class="form-row">
            <div class="form-group half-width">
              <label>Date de naissance</label>
              <input type="date" class="form-control" [(ngModel)]="studentForm.dateNaissance" name="dateNaissance" required>
            </div>
            
            <div class="form-group half-width">
              <label>Classe</label>
              <select class="form-control" [(ngModel)]="studentForm.classeId" name="classeId">
                <option value="">Sélectionner une classe</option>
                <option *ngFor="let classe of classes" [value]="classe.id">{{ classe.nom }} ({{ classe.niveau }})</option>
              </select>
            </div>
          </div>
          
          <div class="form-group">
            <label>Statut</label>
            <select class="form-control" [(ngModel)]="studentForm.status" name="status">
              <option *ngFor="let status of statusOptions" [value]="status.value">{{ status.label }}</option>
            </select>
          </div>
          
          <div *ngIf="!studentForm.id" class="form-row">
            <div class="form-group half-width">
              <label>Mot de passe</label>
              <input type="password" class="form-control" [(ngModel)]="studentForm.password" name="password" required>
            </div>
            
            <div class="form-group half-width">
              <label>Confirmation</label>
              <input type="password" class="form-control" [(ngModel)]="studentForm.passwordConfirm" name="passwordConfirm" required>
            </div>
          </div>
        </form>
        
        <!-- Teacher Form -->
        <form *ngIf="modalContent === 'add-teacher' || modalContent === 'edit-teacher'" (submit)="saveForm()" class="compact-form">
          <div class="form-row">
            <div class="form-group half-width">
              <label>Nom</label>
              <input type="text" class="form-control" [(ngModel)]="teacherForm.nom" name="nom" required>
            </div>
            
            <div class="form-group half-width">
              <label>Prénom</label>
              <input type="text" class="form-control" [(ngModel)]="teacherForm.prenom" name="prenom" required>
            </div>
          </div>
          
          <div class="form-group">
            <label>Email</label>
            <input type="email" class="form-control" [(ngModel)]="teacherForm.email" name="email" required>
          </div>
          
          <div class="form-row">
            <div class="form-group half-width">
              <label>Date de naissance</label>
              <input type="date" class="form-control" [(ngModel)]="teacherForm.dateNaissance" name="dateNaissance" required>
            </div>
            
            <div class="form-group half-width">
              <label>Années d'expérience</label>
              <input type="number" class="form-control" [(ngModel)]="teacherForm.nbAnneeExperience" name="nbAnneeExperience" min="0">
            </div>
          </div>
          
          <div class="form-group">
            <label>Statut</label>
            <select class="form-control" [(ngModel)]="teacherForm.status" name="status">
              <option *ngFor="let status of teacherStatusOptions" [value]="status.value">{{ status.label }}</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Matières enseignées</label>
            <div class="subjects-grid">
              <div *ngFor="let subject of subjects" class="subject-item">
                <input type="checkbox" [id]="'subject-'+subject" 
                       [checked]="teacherForm.matieresEnseignees?.includes(subject)"
                       (change)="toggleTeacherSubject(subject)">
                <label [for]="'subject-'+subject">{{ subject }}</label>
              </div>
            </div>
          </div>
          
          <div *ngIf="!teacherForm.id" class="form-row">
            <div class="form-group half-width">
              <label>Mot de passe</label>
              <input type="password" class="form-control" [(ngModel)]="teacherForm.password" name="password" required>
            </div>
            
            <div class="form-group half-width">
              <label>Confirmation</label>
              <input type="password" class="form-control" [(ngModel)]="teacherForm.passwordConfirm" name="passwordConfirm" required>
            </div>
          </div>
        </form>
        <!-- Class Form -->
<form (ngSubmit)="saveClass()">
  <div class="form-row">
    <div class="form-group half-width">
      <label for="className">Nom de la classe *</label>
      <input type="text" id="className" class="form-control" 
             [(ngModel)]="classForm.nom" name="nom" 
             placeholder="Ex: 3ème A" required>
      <small class="form-text text-muted">Doit être unique</small>
    </div>
    
    <div class="form-group half-width">
      <label for="classLevel">Niveau *</label>
      <select id="classLevel" class="form-control" 
              [(ngModel)]="classForm.niveau" name="niveau" required>
        <option value="" disabled selected>Sélectionner un niveau</option>
        <option *ngFor="let level of classLevels" [value]="level">{{ level }}</option>
      </select>
    </div>
  </div>
  
  <div class="form-group">
    <label>Enseignants assignés</label>
    <div class="teachers-selection-container">
      <div class="available-teachers">
        <div class="search-box">
          <input type="text" placeholder="Rechercher un enseignant..." 
                 (input)="filterTeachers($event)">
        </div>
        <div class="teachers-list">
          <div *ngFor="let teacher of filteredTeachers" class="teacher-item">
            <label>
              <input type="checkbox" 
                     [checked]="isTeacherSelected(teacher.id)"
                     (change)="toggleTeacherSelection(teacher.id)">
              {{ teacher.prenom }} {{ teacher.nom }}
              <span class="teacher-subjects" *ngIf="teacher.matieresEnseignees && teacher.matieresEnseignees.length > 0">
                ({{ teacher.matieresEnseignees.join(', ') }})
              </span>
            </label>
          </div>
          <div *ngIf="filteredTeachers.length === 0" class="no-results">
            Aucun enseignant trouvé
          </div>
        </div>
      </div>
      
      <div class="selected-teachers" *ngIf="classForm.enseignantIds && classForm.enseignantIds.length > 0">
        <h5>Enseignants sélectionnés ({{ classForm.enseignantIds.length }})</h5>
        <ul>
          <li *ngFor="let teacherId of classForm.enseignantIds">
            {{ getTeacherName(teacherId) }}
            <button type="button" class="remove-btn" 
                    (click)="removeTeacher(teacherId)">
              ×
            </button>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <div class="form-actions">
    <button type="button" class="btn btn-secondary" 
            (click)="closeModal()">Annuler</button>
    <button type="submit" class="btn btn-primary" 
            [disabled]="isProcessing || !classForm.nom || !classForm.niveau">
      <span *ngIf="!isProcessing">{{ modalContent === 'add-class' ? 'Créer' : 'Enregistrer' }}</span>
      <span *ngIf="isProcessing" class="spinner-border spinner-border-sm"></span>
    </button>
  </div>
</form>
        
        <!-- Meeting Form -->
        <form *ngIf="modalContent === 'add-meeting' || modalContent === 'edit-meeting'" (submit)="saveForm()" class="compact-form">
          <div class="form-row">
            <div class="form-group half-width">
              <label>Sujet</label>
              <input type="text" class="form-control" [(ngModel)]="meetingForm.sujet" name="sujet" required>
            </div>
            
            <div class="form-group half-width">
              <label>Date/Heure</label>
              <input type="datetime-local" class="form-control" [(ngModel)]="meetingForm.dateHeure" name="dateHeure" required>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group half-width">
              <label>Lieu</label>
              <select class="form-control" [(ngModel)]="meetingForm.lieu" name="lieu" required>
                <option *ngFor="let room of meetingRooms" [value]="room">{{ room }}</option>
              </select>
            </div>
            
            <div class="form-group half-width">
              <label>Enseignant</label>
              <select class="form-control" [(ngModel)]="meetingForm.enseignant" name="enseignant" required>
                <option value="">Sélectionner un enseignant</option>
                <option *ngFor="let teacher of teachers" [ngValue]="teacher">
                  {{ teacher.prenom }} {{ teacher.nom }}
                </option>
              </select>
            </div>
          </div>
          
          <div class="form-group">
            <label>Description</label>
            <textarea class="form-control" [(ngModel)]="meetingForm.description" name="description" rows="3"></textarea>
          </div>
          
          <div class="form-row">
            <div class="form-group half-width">
              <label>Statut</label>
              <select class="form-control" [(ngModel)]="meetingForm.statut" name="statut">
                <option *ngFor="let status of meetingStatusOptions" [value]="status.value">{{ status.label }}</option>
              </select>
            </div>
            
            <div class="form-group half-width checkbox-group">
              <input type="checkbox" class="form-check-input" id="sendEmail" [(ngModel)]="meetingForm.sendEmail" name="sendEmail">
              <label class="form-check-label" for="sendEmail">Envoyer une notification</label>
            </div>
          </div>
        </form>
        
        <!-- Leave Form -->
        <form *ngIf="modalContent === 'add-leave'" (submit)="saveForm()" class="compact-form">
          <div class="form-row">
            <div class="form-group half-width">
              <label>Type de congé</label>
              <select class="form-control" [(ngModel)]="leaveForm.type" name="type" required>
                <option *ngFor="let type of leaveTypes" [value]="type.value">{{ type.label }}</option>
              </select>
            </div>
            
            <div class="form-group half-width">
              <label>Demandeur</label>
              <select class="form-control" [(ngModel)]="leaveForm.demandeurType" name="demandeurType" required>
                <option value="ENSEIGNANT">Enseignant</option>
                <option value="ETUDIANT">Étudiant</option>
              </select>
            </div>
          </div>
          
          <div class="form-row" *ngIf="leaveForm.demandeurType === 'ENSEIGNANT'">
            <div class="form-group">
              <label>Enseignant</label>
              <select class="form-control" [(ngModel)]="leaveForm.enseignant" name="enseignant" required>
                <option *ngFor="let teacher of teachers" [ngValue]="teacher">
                  {{ teacher.prenom }} {{ teacher.nom }}
                </option>
              </select>
            </div>
          </div>
          
          <div class="form-row" *ngIf="leaveForm.demandeurType === 'ETUDIANT'">
            <div class="form-group">
              <label>Étudiant</label>
              <select class="form-control" [(ngModel)]="leaveForm.etudiant" name="etudiant" required>
                <option *ngFor="let student of students" [ngValue]="student">
                  {{ student.prenom }} {{ student.nom }}
                </option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group half-width">
              <label>Date de début</label>
              <input type="date" class="form-control" [(ngModel)]="leaveForm.dateDebut" name="dateDebut" required>
            </div>
            
            <div class="form-group half-width">
              <label>Date de fin</label>
              <input type="date" class="form-control" [(ngModel)]="leaveForm.dateFin" name="dateFin" required>
            </div>
          </div>
          
          <div class="form-group">
            <label>Motif</label>
            <textarea class="form-control" [(ngModel)]="leaveForm.motif" name="motif" rows="3" required></textarea>
          </div>
        </form>
        
        <!-- Note Form -->
        <form *ngIf="modalContent === 'add-note'" (submit)="saveForm()" class="compact-form">
          <div class="form-row">
            <div class="form-group half-width">
              <label>Étudiant</label>
              <select class="form-control" [(ngModel)]="noteForm.etudiantId" name="etudiantId" required>
                <option *ngFor="let student of students" [value]="student.id">
                  {{ student.prenom }} {{ student.nom }} ({{ getClassName(student) }})
                </option>
              </select>
            </div>
            
            <div class="form-group half-width">
              <label>Matière</label>
              <select class="form-control" [(ngModel)]="noteForm.coursId" name="coursId" required>
                <option *ngFor="let course of courses" [value]="course.id">
                  {{ course.nom }} ({{ course.enseignant?.prenom }} {{ course.enseignant?.nom }})
                </option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group half-width">
              <label>Note TP</label>
              <input type="number" class="form-control" [(ngModel)]="noteForm.tp" name="tp" min="0" max="20" step="0.5" required>
            </div>
            
            <div class="form-group half-width">
              <label>Note Examen</label>
              <input type="number" class="form-control" [(ngModel)]="noteForm.exam" name="exam" min="0" max="20" step="0.5" required>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group half-width">
              <label>Type</label>
              <select class="form-control" [(ngModel)]="noteForm.type" name="type">
                <option *ngFor="let type of noteTypes" [value]="type.value">{{ type.label }}</option>
              </select>
            </div>
            
            <div class="form-group half-width">
              <label>Date</label>
              <input type="date" class="form-control" [(ngModel)]="noteForm.date" name="date" required>
            </div>
          </div>
        </form>
      </div>
      
      <div class="modal-footer white-bg">
        <button class="btn btn-secondary" (click)="closeModal()" [disabled]="isProcessing">Annuler</button>
        <button class="btn btn-primary" (click)="saveForm()" [disabled]="isProcessing">
          <span *ngIf="isProcessing"><i class="fas fa-spinner fa-spin"></i> Traitement...</span>
          <span *ngIf="!isProcessing">Enregistrer</span>
        </button>
      </div>
    </div>
  </div>
</div>

<style>
  /* Styles pour les formulaires compacts */
  .compact-form {
    padding: 15px;
    background: white;
    max-height: 70vh;
    overflow-y: auto;
  }

  .compact-form .form-group {
    margin-bottom: 10px;
  }

  .compact-form .half-width {
    width: 48%;
    display: inline-block;
    margin-right: 2%;
    vertical-align: top;
  }

  .compact-form .form-row {
    margin-bottom: 5px;
    display: flex;
    justify-content: space-between;
  }

  .compact-form label {
    font-size: 0.9em;
    margin-bottom: 3px;
    display: block;
    color: #555;
    font-weight: 500;
  }

  .compact-form .form-control {
    padding: 6px 10px;
    font-size: 0.9em;
    height: auto;
    border: 1px solid #ddd;
    border-radius: 4px;
    width: 100%;
  }

  .compact-form .subjects-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 5px;
    max-height: 150px;
    overflow-y: auto;
    padding: 5px;
    background: #f8f9fa;
    border-radius: 4px;
    border: 1px solid #ddd;
  }

  .compact-form .subject-item {
    font-size: 0.8em;
    display: flex;
    align-items: center;
  }

  .compact-form .subject-item input {
    margin-right: 5px;
  }

  .white-bg {
    background-color: white;
    border-radius: 4px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  }

  /* Styles pour la modal */
  .modal {
    background: white;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    max-width: 600px;
    width: 90%;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
  }

  .modal-header {
    padding: 15px 20px;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .modal-body {
    padding: 0;
    flex: 1;
    overflow: hidden;
  }

  .modal-footer {
    padding: 15px 20px;
    border-top: 1px solid #eee;
    display: flex;
    justify-content: flex-end;
    gap: 10px;
  }

  .close-btn {
    background: none;
    border: none;
    font-size: 1.5em;
    cursor: pointer;
    color: #777;
  }

  /* Styles généraux */
  .btn {
    padding: 8px 15px;
    border-radius: 4px;
    border: none;
    cursor: pointer;
    font-size: 0.9em;
    transition: all 0.2s;
  }

  .btn-primary {
    background-color: #4e73df;
    color: white;
  }

  .btn-secondary {
    background-color: #6c757d;
    color: white;
  }

  .btn-danger {
    background-color: #e74a3b;
    color: white;
  }

  .btn-sm {
    padding: 5px 10px;
    font-size: 0.8em;
  }

  .checkbox-group {
    display: flex;
    align-items: center;
    margin-top: 20px;
  }

  .checkbox-group input {
    margin-right: 8px;
  }

  textarea.form-control {
    min-height: 80px;
    resize: vertical;
  }

  select[multiple].form-control {
    height: auto;
    min-height: 100px;
  }
</style>